<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Political Tendency Quiz</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #f5f6fa;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--background-color);
            color: var(--text-color);
            box-sizing: border-box;
            overflow-x: hidden;
            width: 100%;
        }

        .container {
            max-width: 800px;
            width: 95%;
            padding: 1.5rem;
            margin: 1rem auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            box-sizing: border-box;
        }

        .container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .question {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            text-align: center;
            line-height: 1.4;
            padding: 0 0.5rem;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            padding: 0 0.5rem;
        }

        .answer-btn {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: normal;
            text-align: center;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .answer-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--secondary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading {
            display: none;
            text-align: center;
        }

        .loading .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #results {
            display: none;
            text-align: center;
            padding: 0.5rem;
        }

        #results h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        #radarChart {
            max-width: 100%;
            max-height: 500px;
            width: 100%;
            height: 100%;
            margin: 1rem auto;
            padding: 0.5rem;
        }

        .start-screen {
            text-align: center;
            padding: 1rem 0.5rem;
        }

        .start-screen h1 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .start-screen p {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .start-btn, .restart-btn {
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 1.5rem;
            width: 100%;
            max-width: 300px;
        }

        .start-btn:hover, .restart-btn:hover {
            transform: scale(1.05);
        }

        .share-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: nowrap;
            padding: 0 0.5rem;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            color: white;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.2s;
            text-decoration: none;
            position: relative;
        }

        .share-btn:hover {
            opacity: 0.9;
            transform: scale(1.1);
        }

        .share-btn i {
            font-size: 1.4rem;
        }

        .copy-url {
            background-color: #6c5ce7;
        }

        .copy-url.success {
            background-color: #00b894;
            transform: scale(1.1);
        }

        .copy-url.success i {
            animation: checkmark 0.5s ease-in-out;
        }

        @keyframes checkmark {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            bottom: -30px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .share-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .download {
            background-color: #2c3e50;
        }

        .whatsapp {
            background-color: #25D366;
        }

        .twitter {
            background-color: #000000;
        }

        .twitter i {
            color: white;
            font-size: 1.2rem; /* Slightly smaller for X icon */
        }

        .tiktok {
            background: #000000;
            position: relative;
            overflow: hidden;
        }

        .tiktok::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #00f2ea, #ff0050);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tiktok:hover::before {
            opacity: 1;
        }

        .tiktok i {
            position: relative;
            z-index: 1;
        }

        @media (min-width: 768px) {
            .container {
                padding: 2rem;
                margin: 2rem auto;
            }

            .question {
                font-size: 1.5rem;
                padding: 0;
            }

            .answers {
                gap: 1rem;
                padding: 0;
            }

            .answer-btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
            }

            .start-btn, .restart-btn {
                padding: 1rem 3rem;
                font-size: 1.2rem;
                width: auto;
            }

            .start-screen h1 {
                font-size: 2.2rem;
            }

            .start-screen p {
                font-size: 1.2rem;
            }

            #results h2 {
                font-size: 2rem;
            }

            #radarChart {
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                width: 100%;
                margin: 0;
                padding: 1rem;
                border-radius: 0;
            }

            .share-buttons {
                flex-direction: row;
                justify-content: center;
                gap: 0.8rem;
                margin-top: 1.5rem;
            }

            .share-btn {
                width: 40px;
                height: 40px;
            }

            .share-btn i {
                font-size: 1.2rem;
            }

            #radarChart {
                padding: 0;
                margin: 0.5rem auto;
            }

            .question {
                font-size: 1.1rem;
                padding: 0;
                margin-bottom: 1rem;
            }

            .answers {
                padding: 0;
            }
        }

        @media (max-width: 360px) {
            .share-btn {
                width: 35px;
                height: 35px;
            }

            .share-btn i {
                font-size: 1.1rem;
            }

            .share-buttons {
                gap: 0.6rem;
            }
        }

        .loading-text {
            margin-top: 15px;
        }
        
        .loading-text small {
            display: block;
            margin-top: 8px;
            opacity: 0.8;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container visible" id="mainContainer">
        <div class="start-screen" id="startScreen">
            <h1>Political Tendency Quiz</h1>
            <p>Discover your political leanings through this thoughtful quiz.</p>
            <button class="start-btn" onclick="startQuiz()">Start Quiz</button>
        </div>

        <div id="quizContent" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="question" id="questionText"></div>
            <div class="answers" id="answersContainer"></div>
        </div>

        <div class="loading" id="loadingScreen">
            <div class="spinner"></div>
            <p id="loadingText" class="loading-text">Calculating your results...</p>
        </div>

        <div id="results">
            <h2>Your Political Tendency Profile</h2>
            <canvas id="radarChart"></canvas>
            <button class="restart-btn" onclick="restartQuiz()">Take Quiz Again</button>
            
            <div class="share-buttons">
                <a href="#" class="share-btn download" onclick="downloadResults()" title="Download Results">
                    <i class="fas fa-download"></i>
                    <span class="tooltip">Download Image</span>
                </a>
                <a href="#" class="share-btn copy-url" onclick="copyShareUrl(this)" title="Copy URL">
                    <i class="fas fa-link"></i>
                    <span class="tooltip">Copy Link</span>
                </a>
                <a href="#" class="share-btn whatsapp" onclick="shareResults('whatsapp')" title="Share on WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                    <span class="tooltip">Share on WhatsApp</span>
                </a>
                <a href="#" class="share-btn twitter" onclick="shareResults('twitter')" title="Share on X">
                    <i class="fa-brands fa-x"></i>
                    <span class="tooltip">Share on X</span>
                </a>
                <a href="#" class="share-btn tiktok" onclick="shareResults('tiktok')" title="Share on TikTok">
                    <i class="fab fa-tiktok"></i>
                    <span class="tooltip">Share on TikTok</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Add Font Awesome for social icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <script>
        let questions = null;
        let currentStep = 1;
        let isSharedResult = false;
        let scores = {
            Authority: 0, Liberty: 0,
            Security: 0, Openness: 0,
            Traditionalism: 0, Progressivism: 0,
            Nationalism: 0, Globalism: 0,
            Collectivism: 0, Individualism: 0,
            Equality: 0, Meritocracy: 0
        };

        // Function to encode scores to compact string
        function encodeScores(scores) {
            // Order of values in the encoded string
            const order = [
                'Authority', 'Liberty',
                'Security', 'Openness',
                'Traditionalism', 'Progressivism',
                'Nationalism', 'Globalism',
                'Collectivism', 'Individualism',
                'Equality', 'Meritocracy'
            ];
            
            // Convert scores to 0-99 range and join with commas
            return order.map(key => {
                // Round to nearest integer and ensure 0-99 range
                const value = Math.max(0, Math.min(99, Math.round(scores[key])));
                // Convert to two digits, pad with zero if needed
                return value.toString().padStart(2, '0');
            }).join('');
        }

        // Function to decode scores from compact string
        function decodeScores(encoded) {
            try {
                const order = [
                    'Authority', 'Liberty',
                    'Security', 'Openness',
                    'Traditionalism', 'Progressivism',
                    'Nationalism', 'Globalism',
                    'Collectivism', 'Individualism',
                    'Equality', 'Meritocracy'
                ];

                const scores = {};
                // Each score is 2 digits
                for (let i = 0; i < order.length; i++) {
                    const value = parseInt(encoded.substr(i * 2, 2), 10);
                    scores[order[i]] = value;
                }
                return scores;
            } catch (e) {
                return null;
            }
        }

        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        async function loadQuestions() {
            const response = await fetch('questions.json');
            questions = await response.json();

            // Check for shared results in URL
            const sharedResults = getUrlParameter('r');
            if (sharedResults) {
                const decodedScores = decodeScores(sharedResults);
                if (decodedScores) {
                    isSharedResult = true;
                    scores = decodedScores;
                    document.getElementById('startScreen').style.display = 'none';
                    showLoadingScreen();
                    return;
                }
            }

            document.getElementById('mainContainer').classList.add('visible');
        }

        function startQuiz() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('quizContent').style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            const container = document.getElementById('mainContainer');
            container.classList.remove('visible');
            
            setTimeout(() => {
                const stepQuestions = questions[currentStep].questions;
                const randomQuestion = stepQuestions[Math.floor(Math.random() * stepQuestions.length)];
                
                document.getElementById('questionText').textContent = randomQuestion.question;
                
                const answersContainer = document.getElementById('answersContainer');
                answersContainer.innerHTML = '';
                
                ['Yes', 'No', 'Neutral'].forEach(answer => {
                    const button = document.createElement('button');
                    button.className = 'answer-btn';
                    button.textContent = answer;
                    button.onclick = () => handleAnswer(randomQuestion.answers[answer]);
                    answersContainer.appendChild(button);
                });

                document.getElementById('progressFill').style.width = `${((currentStep - 1) / 9) * 100}%`;
                
                container.classList.add('visible');
            }, 500);
        }

        function handleAnswer(answerScores) {
            Object.entries(answerScores).forEach(([attribute, score]) => {
                scores[attribute] += score;
            });

            if (currentStep < 9) {
                currentStep++;
                showQuestion();
            } else {
                showLoadingScreen();
            }
        }

        function showLoadingScreen() {
            document.getElementById('quizContent').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            
            // Update loading text based on context
            const loadingText = document.getElementById('loadingText');
            if (isSharedResult) {
                loadingText.innerHTML = 'Loading shared profile...<br><small>Someone shared their political tendency profile with you!</small>';
            } else {
                loadingText.textContent = 'Calculating your results...';
            }

            setTimeout(showResults, 1500);
        }

        function normalizeScores() {
            // Find min and max for each pair of opposing values
            const pairs = {
                'Authority-Liberty': ['Authority', 'Liberty'],
                'Security-Openness': ['Security', 'Openness'],
                'Traditionalism-Progressivism': ['Traditionalism', 'Progressivism'],
                'Nationalism-Globalism': ['Nationalism', 'Globalism'],
                'Collectivism-Individualism': ['Collectivism', 'Individualism'],
                'Equality-Meritocracy': ['Equality', 'Meritocracy']
            };

            const normalized = {};
            
            // Normalize each pair
            Object.values(pairs).forEach(([attr1, attr2]) => {
                const total = Math.abs(scores[attr1]) + Math.abs(scores[attr2]);
                if (total === 0) {
                    // If both scores are 0, set them to 50 (neutral)
                    normalized[attr1] = 50;
                    normalized[attr2] = 50;
                } else {
                    // Convert to percentage but maintain the relationship
                    normalized[attr1] = (scores[attr1] / total * 100 + 100) / 2;
                    normalized[attr2] = (scores[attr2] / total * 100 + 100) / 2;
                }
            });
            
            return normalized;
        }

        function showResults() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('results').style.display = 'block';

            const normalizedScores = normalizeScores();
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            // Create a mapping of original keys to display labels and define the order
            const dimensionOrder = [
                'Globalism',       
                'Progressivism',        
                'Nationalism',        
                'Individualism',   
                'Meritocracy',     
                'Traditionalism',  
                'Authority',       
                'Security',        
                'Liberty',         
                'Collectivism',     
                'Equality',        
                'Openness'    
            ];

            const dimensionLabels = {
                'Authority'      : 'Order‑Driven',
                'Liberty'        : 'Freedom‑Oriented',
                'Security'       : 'Safety‑Minded',
                'Openness'       : 'Open‑Minded',
                'Traditionalism' : 'Tradition‑Focused',
                'Progressivism'  : 'Forward‑Looking',
                'Nationalism'    : 'Nation‑Centric',
                'Globalism'      : 'World‑Centric',
                'Collectivism'   : 'Community‑Oriented',
                'Individualism'  : 'Self‑Reliant',
                'Equality'       : 'Fairness‑Focused',
                'Meritocracy'    : 'Achievement‑Driven'
              };

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensionOrder.map(key => dimensionLabels[key]),
                    datasets: [{
                        label: 'Your Political Profile',
                        data: dimensionOrder.map(key => normalizedScores[key]),
                        fill: true,
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(52, 152, 219, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    layout: {
                        padding: {
                            top: 40,
                            right: 40,
                            bottom: 40,
                            left: 40
                        }
                    },
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: {
                                font: {
                                    size: 12
                                },
                                stepSize: 20,
                                showLabelBackdrop: true,
                                backdropColor: 'rgba(255, 255, 255, 0.75)'
                            },
                            pointLabels: {
                                font: {
                                    size: 12
                                },
                                centerPointLabels: false,
                                padding: 25,
                                display: true,
                                callback: function(value, index) {
                                    return value.split('‑');
                                },
                                textAlign: 'center'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            enabled: true,
                            callbacks: {
                                label: function(context) {
                                    return `Score: ${Math.round(context.raw)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function restartQuiz() {
            // Reset all variables
            currentStep = 1;
            scores = {
                Authority: 0, Liberty: 0,
                Security: 0, Openness: 0,
                Traditionalism: 0, Progressivism: 0,
                Nationalism: 0, Globalism: 0,
                Collectivism: 0, Individualism: 0,
                Equality: 0, Meritocracy: 0
            };
            
            // Hide results and show start screen
            document.getElementById('results').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('quizContent').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'none';
            
            // Reset progress bar
            document.getElementById('progressFill').style.width = '0%';
            
            // Ensure container is visible
            document.getElementById('mainContainer').classList.add('visible');
        }

        function generateResultImage() {
            return new Promise((resolve) => {
                const chartCanvas = document.getElementById('radarChart');
                const chartImage = chartCanvas.toDataURL('image/png');
                
                // Create a temporary canvas
                const tempCanvas = document.createElement('canvas');
                const ctx = tempCanvas.getContext('2d');
                tempCanvas.width = chartCanvas.width;
                tempCanvas.height = chartCanvas.height + 60;
                
                // Fill background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                
                // Add the chart
                const chartImg = new Image();
                chartImg.onload = function() {
                    ctx.drawImage(chartImg, 0, 0);
                    
                    // Add title
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = 'bold 16px "Segoe UI", sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('My Political Tendency Profile', tempCanvas.width/2, tempCanvas.height - 30);
                    
                    resolve(tempCanvas.toDataURL('image/png'));
                };
                chartImg.src = chartImage;
            });
        }

        async function downloadResults() {
            const imageData = await generateResultImage();
            const link = document.createElement('a');
            link.download = 'political-tendency-profile.png';
            link.href = imageData;
            link.click();
        }

        async function shareResults(platform) {
            const baseUrl = window.location.origin + window.location.pathname;
            const encodedResults = encodeScores(scores);
            const shareUrl = `${baseUrl}?r=${encodedResults}`;
            const text = 'Check out my Political Tendency Profile! See my results at: ';
            
            switch (platform) {
                case 'whatsapp':
                    const imageData = await generateResultImage();
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: 'My Political Tendency Profile',
                                text: text,
                                url: shareUrl,
                                files: [dataURLtoFile(imageData, 'political-profile.png')]
                            });
                        } catch (err) {
                            window.open(`https://wa.me/?text=${encodeURIComponent(text + shareUrl)}`, '_blank');
                        }
                    } else {
                        window.open(`https://wa.me/?text=${encodeURIComponent(text + shareUrl)}`, '_blank');
                    }
                    break;
                case 'twitter':
                    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(shareUrl)}`, '_blank');
                    break;
                case 'tiktok':
                    // Since TikTok doesn't have a direct share URL, copy to clipboard
                    try {
                        await navigator.clipboard.writeText(text + shareUrl);
                        alert('Link copied to clipboard! You can now paste it on TikTok.');
                    } catch (err) {
                        window.open('https://www.tiktok.com', '_blank');
                    }
                    break;
            }
        }

        // Helper function to convert Data URL to File object
        function dataURLtoFile(dataurl, filename) {
            let arr = dataurl.split(','),
                mime = arr[0].match(/:(.*?);/)[1],
                bstr = atob(arr[1]),
                n = bstr.length,
                u8arr = new Uint8Array(n);
            while(n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], filename, {type: mime});
        }

        async function copyShareUrl(button) {
            const baseUrl = window.location.origin + window.location.pathname;
            const encodedResults = encodeScores(scores);
            const shareUrl = `${baseUrl}?r=${encodedResults}`;
            
            try {
                await navigator.clipboard.writeText(shareUrl);
                
                // Visual feedback
                button.classList.add('success');
                const icon = button.querySelector('i');
                icon.classList.remove('fa-link');
                icon.classList.add('fa-check');
                
                // Reset after 2 seconds
                setTimeout(() => {
                    button.classList.remove('success');
                    icon.classList.remove('fa-check');
                    icon.classList.add('fa-link');
                }, 2000);
                
            } catch (err) {
                alert('Failed to copy URL. Please try again.');
            }
        }

        // Initialize the quiz
        loadQuestions().then(() => {
            document.getElementById('mainContainer').classList.add('visible');
        });
    </script>
</body>
</html> 